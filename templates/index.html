<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gi√°m S√°t Giao Th√¥ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Header -->
    <div class="header-container">
        <div class="header-text">
            GI√ÅM S√ÅT GIAO TH√îNG - TNUT
        </div>
        <div class="notification-bar">
            TR∆Ø·ªúNG ƒê·∫†I H·ªåC K·ª∏ THU√ÇT C√îNG NGHI·ªÜP
        </div>
        <div class="nav-buttons">
            <button class="btn btn-success" onclick="window.location.href='/'">Theo d√µi</button>
            <div class="dropdown d-inline-block">
                <button class="btn btn-warning dropdown-toggle" type="button" data-bs-toggle="dropdown">B√°o c√°o</button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="/report/0?date={{ current_date }}">Khu v·ª±c 1</a></li>
                    <li><a class="dropdown-item" href="/report/1?date={{ current_date }}">Khu v·ª±c 2</a></li>
                    <li><a class="dropdown-item" href="/report/2?date={{ current_date }}">Khu v·ª±c 3</a></li>
                </ul>
            </div>
            <div class="dropdown d-inline-block">
                <button class="btn btn-danger dropdown-toggle" type="button" data-bs-toggle="dropdown">D·ª± ƒëo√°n</button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="/prediction/0">Khu v·ª±c 1</a></li>
                    <li><a class="dropdown-item" href="/prediction/1">Khu v·ª±c 2</a></li>
                    <li><a class="dropdown-item" href="/prediction/2">Khu v·ª±c 3</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="row">
            <!-- Left Panel: Video Feed -->
            <div class="col-md-8">
                <div class="box2">
                    <h4 class="text-center">VIDEO THEO D√ïI</h4>
                    <img src="{{ url_for('video_feed') }}" alt="Video Feed" class="img-fluid">
                </div>
            </div>

            <!-- Right Panel: Realtime Counts -->
            <div class="col-md-4">
                <div class="left-panel">
                    <h5><b>üìä S·ªë l∆∞·ª£ng xe th·ªùi gian th·ª±c</b></h5>
                    {% for roi, data in counts.items() %}
                        <div class="mt-3">
                            <h6><b>Khu v·ª±c {{ roi|int + 1 }}</b></h6>
                            {% for type, count in data.items() %}
                                <p>{{ type }}: {{ count }}</p>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for Realtime Updates -->
    <script>
        setInterval(() => {
            fetch('/api/counts/realtime')
                .then(response => response.json())
                .then(data => {
                    const stats = document.querySelector('.left-panel');
                    stats.innerHTML = '<h5><b>üìä S·ªë l∆∞·ª£ng xe th·ªùi gian th·ª±c</b></h5>';
                    Object.entries(data).forEach(([roi, counts]) => {
                        stats.innerHTML += `<div class="mt-3"><h6><b>Khu v·ª±c ${parseInt(roi) + 1}</b></h6>`;
                        Object.entries(counts).forEach(([type, count]) => {
                            stats.innerHTML += `<p>${type}: ${count}</p>`;
                        });
                        stats.innerHTML += `</div>`;
                    });
                });
        }, 5000);
    </script>
</body>
</html>